<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="MIT 6.824 åˆ†å¸ƒå¼ç³»ç»Ÿè¯¾ç¨‹- å®ç°Mapreduce Lab1" />
    <meta name="hexo-theme-A4" content="v1.9.8" />
    <link rel="alternate icon" type="image/webp" href="/img/20250602032635.jpg">
    <title>Yann | æˆ‘æ„¿åšä½ å…‰åä¸­æ·¡æ·¡çš„ä¸€ç¬”</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="/css/custom.css">

    

<meta name="generator" content="Hexo 5.4.2"></head>
    
    

    
    



    
        <style>
            .paper-main{
                max-width:  1200px;
            }
        </style>

    
    




    
    <style>
        :root {
            --waline-theme-color: #323e74; 
            --waline-color: #323e74; 
            --waline-border-color: #323e74; 
            --waline-white: #323e74; 
            --waline-bgcolor-light: #f2fafc;  
        }
        body {
            color: #323e74;
            background: #eaeae8;
        }
        .post-md code {
            background: #e7f7f3;
            color: #7f688d; 
        }
        .post-md pre, .post-md .highlight {
            background: #e7f7f3;
            color: #7f688d; 
        }
        pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
            color: #323e74;
        }
        pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
            color: #323e74;
        }
        .year-font-color {
            color: #323e74 !important;
        }
        .wl-card span.wl-nick {
            color: #323e74; 
        }
        .wl-card .wl-badge {
            border: 1px solid #323e74;
            color: #323e74; 
        }
        .wl-btn {
            border: 1px solid #323e74; 
            color:  #323e74;  
        }
        .wl-btn.primary {
            color: #f2fafc; 
        }
        .wl-header label {
            color: #323e74;
        }
        a {
            color: #7f688d;
        }

        .post-md a {
            color: #7f688d;
        }

        .nav li a {
            color: #7f688d;
        }

        .archive-main a:link {
            color: #7f688d;
        }
        .archive-main a:visited {
            color: #767c7c; 
        }

        .archive li span {
            color: #323e74;
        }

        .post-main-title {
            color: #323e74;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #323e74;
        }

        [data-waline] p {
            color: #323e74;
        }
        [data-waline] a {
            color: #323e74;
        } 
        .wl-sort li.active {
            color: #323e74;
        }

        .wl-card .wl-meta>span {
            background: #f2fafc;
        }

        .paper {
            background: #eaeae8;
        }

        .index-main {
            background: #f2fafc;
        }

        .paper-main {
            background: #f2fafc;
        }

        .wl-panel {
            background: #f2fafc;
        }

        .archive li:nth-child(odd) {
            background: #f2fafc;
            ;
        }

        .archive li:nth-child(even) {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(odd) td {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(even) td {
            background: #f2fafc;
        }

    
        .progress-wrap::after {
            color: #323e74; /* ç®­å¤´çš„é¢œè‰² */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

        .return-to-last-progress-wrap::after {
            color: #323e74; /* ç®­å¤´çš„é¢œè‰² */
        }
        .return-to-last-progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .return-to-last-progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #323e74; /* è®¾ç½®æ»šåŠ¨æ¡æ‹–åŠ¨å—çš„é¢œè‰² */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: #7f688d;
            border-left-color: #7f688d;
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #323e74;
        }
    </style>

    
    <style>
        body {
            background-image: url(/img/3.jpg);
            background-attachment: fixed;  /* èƒŒæ™¯å›ºå®šï¼Œä¸éšé¡µé¢æ»šåŠ¨ */
            background-repeat: no-repeat;  /* é˜²æ­¢èƒŒæ™¯å›¾ç‰‡é‡å¤ */
            background-size: cover;       /* èƒŒæ™¯è‡ªé€‚åº”å¤§å°ï¼Œè¦†ç›–æ•´ä¸ªèƒŒæ™¯ */
            background-position: center;   /* èƒŒæ™¯å±…ä¸­æ˜¾ç¤º */
        }
        .paper {
            background-image: url(/img/3.jpg);
            background-attachment: fixed;  /* èƒŒæ™¯å›ºå®šï¼Œä¸éšé¡µé¢æ»šåŠ¨ */
            background-repeat: no-repeat;  /* é˜²æ­¢èƒŒæ™¯å›¾ç‰‡é‡å¤ */
            background-size: cover;       /* èƒŒæ™¯è‡ªé€‚åº”å¤§å°ï¼Œè¦†ç›–æ•´ä¸ªèƒŒæ™¯ */
            background-position: center;   /* èƒŒæ™¯å±…ä¸­æ˜¾ç¤º */
        }  
    </style>


    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #eaeae8  ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            
                <div class="left-toc-container">
                    <nav id="toc" class="bs-docs-sidebar"></nav>
                </div>
            
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 0; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/img/20250602032635.jpg" 
        />
        <div class="header-content">
            <a class="logo" href="/">Yann</a> 
            <span class="description">äººå·¥æ™ºèƒ½ã€è®¡ç®—æœºã€æœºå™¨å­¦ä¹ ã€linuxã€ç¨‹åºå‘˜</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    MIT 6.824 åˆ†å¸ƒå¼ç³»ç»Ÿè¯¾ç¨‹- å®ç°Mapreduce Lab1
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2021-05-17</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š1.7k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š8åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">è¯¾ç¨‹ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-MapReduce%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="post-toc-text">1 MapReduceåŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-%E5%AE%9E%E9%AA%8C%E8%A6%81%E6%B1%82"><span class="post-toc-text">2 å®éªŒè¦æ±‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-%E6%B5%81%E7%A8%8B"><span class="post-toc-text">3 æµç¨‹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">4 ä»£ç å®ç°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Part-1%EF%BC%8C-Part-2"><span class="post-toc-text">Part 1ï¼Œ Part 2</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Part-3"><span class="post-toc-text">Part 3</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Part-4"><span class="post-toc-text">Part 4</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Part-5"><span class="post-toc-text">Part 5</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="post-toc-text">å®ç°ç»†èŠ‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="post-toc-text">æµ‹è¯•</span></a></li></ol>
            
        
        <div class=".article-gallery"><span id="more"></span>
<h2 id="è¯¾ç¨‹ä»‹ç»"><a href="#è¯¾ç¨‹ä»‹ç»" class="headerlink" title="è¯¾ç¨‹ä»‹ç»"></a><strong>è¯¾ç¨‹ä»‹ç»</strong></h2><p>Distributed Systemsè¯¾ç¨‹ä¸€å…±åŒ…å«Lab1-4å…±4ä¸ªå¤§ä½œä¸šï¼ŒLab1æ˜¯å®ç°MapreduceåŸå‹ï¼ŒLab2-4æ˜¯å®ç°Raftä»¥åŠåŸºäºRaftå®ç°åˆ†å¸ƒå¼KVå­˜å‚¨ã€‚</p>
<p>æœ¬æ¬¡å®ç°MapReduceï¼Œæ¡†æ¶ä»£ç æ¥è‡ª git://g.csail.mit.edu/6.824-golabs-2020 6.824</p>
<p><a target="_blank" rel="noopener" href="https://stonecharioteer.com/assets/documents/pages/mit-6.824/mapreduce-osdi04.pdf">MapReduce: Simplified Data Processing on Large Clusters</a> is the publication that talks about MapReduce and what it means for computing in general. It is in the required reading. I will read it after video one.</p>
<h2 id="1-MapReduceåŸºç¡€æ¦‚å¿µ"><a href="#1-MapReduceåŸºç¡€æ¦‚å¿µ" class="headerlink" title="1 MapReduceåŸºç¡€æ¦‚å¿µ"></a>1 MapReduceåŸºç¡€æ¦‚å¿µ</h2><p>map è´Ÿè´£åˆ†å‘ã€‚æ¯ä¸ªmapä»»åŠ¡é€šå¸¸å¤„ç†ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ‰å¤šå°‘ä¸ªè¾“å…¥æ–‡ä»¶å°±æœ‰å¤šå°‘ä¸ªmapä»»åŠ¡ã€‚è€Œè¾“å‡ºåˆ™æ ¹æ®reduceçš„æ•°ç›®ç¡®å®šæœ‰å¤šå°‘ä¸ªè¾“å‡ºã€‚æ³¨æ„ï¼Œç›¸åŒçš„keyè‚¯å®šæ˜¯è¾“å‡ºåˆ°åŒä¸€ä¸ªreduceæ–‡ä»¶ä¸­ï¼Œé€šè¿‡å“ˆå¸Œç®—æ³•æ¥ç¡®è®¤ä¸€ä¸ªkeyåº”è¯¥åˆ†å‘åˆ°å“ªä¸ªä¸­é—´æ–‡ä»¶ã€‚targetReduct = ihash(key) % nReduceã€‚<br>æ€»çš„ä¸­é—´æ–‡ä»¶æ•°ä¸º nMap * nReduce</p>
<p>reduceè´Ÿè´£å¯¹mapè¾“å‡ºçš„æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ¯ä¸ªreduceå¤„ç†è‡ªå·±è´Ÿè´£çš„é‚£äº›ä¸­é—´æ–‡ä»¶ã€‚è´Ÿè´£å¤„ç†çš„ä¸­é—´æ–‡ä»¶åå¯ä»¥ç”±mapä¸ªæ•°å’Œreduce numberæ¥ç¡®è®¤ã€‚</p>
<p> MapReduce is essentially splitting a problem into smaller sets based on some criteria, and then assembling the solution from partial solutions. Map a function onto a list of inputs, and then <em>reduce</em> the results into solutions.</p>
<p>The example he shows is a word count functionality. Given a set of files, how would you give a word count across them?</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># this isn<span class="string">&#x27;t executable code btw. Just me thinking out loud.</span></span><br><span class="line"><span class="string">def map(key, value):</span></span><br><span class="line"><span class="string">    files = value</span></span><br><span class="line"><span class="string">    for file in files:</span></span><br><span class="line"><span class="string">        for word in file:</span></span><br><span class="line"><span class="string">            yield word, 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def reduce(key, value):</span></span><br><span class="line"><span class="string">    yield len(value)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>The way this would work is:</p>
<ol>
<li>The map function would return something like a dictionary in python terms, and it would have perhaps the file name, and then a data structure that has the word and its count in this file.</li>
<li>The reduce file would use all these outputs, and then <em>mush</em> them together by returning another final result that has the <em>overall</em> solution.</li>
</ol>
<p>So this could be scaled by splitting the problem <em>across</em> CPUs or <em>machines</em> themselves.</p>
<p>Makes sense. I guess that is why it is used with Hadoop. Hadoop is a joint filesystem that enables such a mechanism, especially when youâ€™d need to process actual <em>files</em>.</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=cQP8WApzIQQ?t=4000s">@1h9m</a> <em>Aha!</em> So Hadoop came out of a necessity to <em>facilitate</em> MapReduce. Google File System, huh? That makes sense. Having a network file system that enables splitting a huge file and saving it across servers makes so much sense if you operate like this. And this also comes with data safety guarantees. Hadoop naturally has data backup guarantees and replications (3 is default, I think)</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=cQP8WApzIQQ?t=4260s">@1h12m</a> GFS would schedule the map task <em>where</em> the data chunks were for network efficiency? That makes sense because the map job packet size must be <em>much lower</em> than the data that it operates on. This is good. Helps me understand what the heck is going on with Hadoop.</p>
<p>Map stores its output on the disk of the machine that it executes on. But to group together all the values associated to a key and then to <strong>reduce</strong> them on a separate machine, they need to be moved later. So the row-wise data of say, words in a word count dictionary, would have to be converted to a columnar dataset of words and their counts as opposed to a collection of different words and their individual counts across different files.</p>
<p>Say:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># again, don<span class="string">&#x27;t try to run this.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">map_output_1 = &#123;</span></span><br><span class="line"><span class="string">    &quot;cat&quot;: 10,</span></span><br><span class="line"><span class="string">    &quot;dog&quot;: 20</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">map_output_2 = &#123;</span></span><br><span class="line"><span class="string">    &quot;elephant&quot;: 2,</span></span><br><span class="line"><span class="string">    &quot;dog&quot;: 29</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>This would then need to be turned into <em>3 reduce jobs</em>. One for the key â€œcatâ€, one for â€œdogâ€ and one for â€œelephantâ€ across these two outputs.</p>
<p>Huh. How would you do sorting in MapReduce? Wouldnâ€™t you need to know where something would appear? Perhaps split large arrays and sort sections and then sort those again? There was an algorithm for that, I think. I had watched some animation that showed this.</p>
<p>Chaining together MapReduce seems to be a normal procedure. I suppose sorting could operate like that.</p>
<h2 id="2-å®éªŒè¦æ±‚"><a href="#2-å®éªŒè¦æ±‚" class="headerlink" title="2 å®éªŒè¦æ±‚"></a>2 å®éªŒè¦æ±‚</h2><ul>
<li>worker å•æ–¹é¢çš„å‘ Master å‘é€æ¶ˆæ¯ï¼›</li>
<li>å¦‚æœä¸€ä¸ª worker æ²¡æœ‰åœ¨åˆç†æ—¶é—´å†…ï¼ˆ10sï¼‰å®Œæˆä»»åŠ¡å°±ç®—æ•…éšœï¼›</li>
</ul>
<h2 id="3-æµç¨‹"><a href="#3-æµç¨‹" class="headerlink" title="3 æµç¨‹"></a>3 æµç¨‹</h2><p><a target="_blank" rel="noopener" href="https://github.com/guomo233/Distributed-Systems/raw/master/images/mapreduce.jpg" title="mapreduce" class="gallery-item" style="box-shadow: none;"> <img src="https://github.com/guomo233/Distributed-Systems/raw/master/images/mapreduce.jpg" alt="mapreduce"></a></p>
<h2 id="4-ä»£ç å®ç°"><a href="#4-ä»£ç å®ç°" class="headerlink" title="4 ä»£ç å®ç°"></a>4 ä»£ç å®ç°</h2><p>åŸå§‹ä»£ç æœ‰ä¸¤ä¸ªç›®å½•ï¼šmainå’Œmapreduceã€‚å…¶ä¸­mainç›®å½•ä¸‹åªéœ€è¦å…³æ³¨<code>wc.goï¼Œii.goä»¥åŠä¸€ç³»åˆ—çš„txtæ–‡ä»¶</code>ã€‚ mapreduceç›®å½•åˆ™éœ€è¦ä¿®æ”¹<code>schedule.go</code>ï¼Œ<code>common_map.go</code>å’Œ<code>common_reduce.go</code>æ–‡ä»¶ã€‚</p>
<h3 id="Part-1ï¼Œ-Part-2"><a href="#Part-1ï¼Œ-Part-2" class="headerlink" title="Part 1ï¼Œ Part 2"></a>Part 1ï¼Œ Part 2</h3><p>è¿™ä¸¤ä¸ªå®éªŒéƒ½æ¯”è¾ƒç®€å•ï¼Œå•æœºçš„ã€‚Part 1å®ç°common_map.goå’Œcommon_reduce.goä¸­çš„é€šç”¨å‡½æ•°ï¼Œè€ŒPart 2ä¹Ÿåªæ˜¯ç»Ÿè®¡å•è¯æ•°ç›®ã€‚Part 2è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œè¦ä½¿ç”¨å®éªŒæ–‡æ¡£ä¸­è¯´çš„åˆ†å‰²æ–¹æ³•<code>unicode.IsLetter()</code>å»åˆ†å‰²å•è¯ï¼Œä¸ç„¶æµ‹è¯•ä¼šæ— æ³•é€šè¿‡ã€‚</p>
<h3 id="Part-3"><a href="#Part-3" class="headerlink" title="Part 3"></a>Part 3</h3><p>é‡‡ç”¨çš„åˆ†å¸ƒå¼æ‰§è¡Œä»»åŠ¡ã€‚å…ˆæ˜¯masterå¯åŠ¨rpcæœåŠ¡ï¼Œå¹¶è°ƒç”¨scheduleå‡½æ•°æ‰§è¡ŒTaskã€‚æ³¨æ„çš„æ˜¯ï¼ŒWorkerå¯åŠ¨åéœ€è¦è°ƒç”¨masterçš„RPCæ–¹æ³•Registeræ³¨å†Œåˆ°masterï¼Œè€Œmasterå‘ç°æœ‰äº†æ–°çš„workerï¼Œä¼šé€šçŸ¥ç­‰å¾…channelçš„åç¨‹è¿›è¡Œä»»åŠ¡æ“ä½œï¼ŒåŒä¸€ä¸ªworkeréœ€è¦å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶ç»™ä¸€ä¸ªworkeråˆ†é…å¤šä¸ªä»»åŠ¡ã€‚</p>
<p>æ³¨æ„åœ¨runä¸­ï¼Œå…ˆåšmapä»»åŠ¡ï¼Œåšå®Œmapå†åšreduceã€‚æ‰€ä»¥åœ¨å¤šä¸ªworkeråšmapä»»åŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ç­‰æ‰€æœ‰çš„mapä»»åŠ¡å®Œæˆå†ç»§ç»­reduceä»»åŠ¡ã€‚è¿™é‡Œç”¨äº† <code>WaitGroup</code>ã€‚</p>
<p>å¦å¤–ï¼Œåˆ†é…workerçš„ç®—æ³•è¦æ³¨æ„ï¼Œæ˜¯æ¯æ¬¡æœ‰æ–°çš„å¯èƒ½ä¼šåˆ†é…åˆ°ï¼Œè€Œè€çš„workerå¦‚æœæ‰§è¡Œå®Œäº†ä¸€æ¬¡ä»»åŠ¡ï¼Œåˆ™ä¹Ÿè¦æ”¾å›channelä¸­ä»¥é‡å¤ä½¿ç”¨ã€‚</p>
<h3 id="Part-4"><a href="#Part-4" class="headerlink" title="Part 4"></a>Part 4</h3><p>workerå¤±è´¥çš„æƒ…å†µä¸‹çš„å®éªŒï¼Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶åŠ ä¸ªforå¾ªç¯ï¼Œå¦‚æœæˆåŠŸåˆ™é€€å‡ºï¼Œå¦åˆ™é‡æ–°å–workeræ‰§è¡Œä»»åŠ¡ã€‚</p>
<h3 id="Part-5"><a href="#Part-5" class="headerlink" title="Part 5"></a>Part 5</h3><p>Part 5éœ€è¦å®Œæˆä¸€ä¸ªå€’æ’ç´¢å¼•ï¼Œå®Œæˆii.goå³å¯ï¼Œè·Ÿwc.goç±»ä¼¼ï¼Œä¸»è¦æ˜¯è¦å»æ‰é‡å¤ä»¥åŠå¯¹å€’æ’åˆ—è¡¨æ’åºå°±å¯ä»¥é€šè¿‡æµ‹è¯•äº†ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><p>Master å®ç°äº mr/master.goï¼Œç”± main/mrmaster.go é©±åŠ¨ï¼Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ å…¥è¾“å…¥æ–‡ä»¶ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†å‘ç»™ woker çš„ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">type</span> Task <span class="keyword">struct</span> &#123;</span><br><span class="line">	Phase   <span class="comment">// æ ‡æ³¨æ˜¯ Map è¿˜æ˜¯ Reduce</span></span><br><span class="line">	Misson</span><br><span class="line">	R <span class="keyword">int</span>   <span class="comment">// Reduce æ•°é‡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Master <span class="keyword">struct</span> &#123;</span><br><span class="line">	mMisson []Misson   <span class="comment">// å¾…åˆ†é…åˆ°ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">	rMisson []Misson</span><br><span class="line">	mTasks []taskState <span class="comment">// ç»´æŠ¤ woker çš„çŠ¶æ€</span></span><br><span class="line">	rTasks []taskState</span><br><span class="line">	mCompleted <span class="keyword">int</span>     <span class="comment">// woker çš„å®Œæˆæ•°é‡</span></span><br><span class="line">	rCompleted <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Master)</span> <span class="title">Assign</span><span class="params">(_ *Task, t *Task)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(m.mMisson) &gt; <span class="number">0</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">		<span class="comment">// t.Id == t.Mission.Id</span></span><br><span class="line">    <span class="comment">// ä¿è¯åŒä¸€ä¸ªä»»åŠ¡æ‰€å¯¹åº”çš„ task åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">		m.mTasks[t.Id] = taskState&#123;<span class="literal">false</span>, timer&#125;</span><br><span class="line">		<span class="keyword">go</span> m.mapCrush(t)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> m.mapDone() &amp;&amp; <span class="built_in">len</span>(m.rMisson) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// t.Id == t.Mission.Id</span></span><br><span class="line">    <span class="comment">// ä¿è¯åŒä¸€ä¸ªä»»åŠ¡æ‰€å¯¹åº”çš„ task åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">		m.rTasks[t.Id] = taskState&#123;<span class="literal">false</span>, timer&#125;</span><br><span class="line">		<span class="keyword">go</span> m.reduceCrush(t)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// é€šçŸ¥ worker sleep ä¸€ä¼š</span></span><br><span class="line">		t.Phase = Idle</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MakeMaster</span><span class="params">(files []<span class="keyword">string</span>, nReduce <span class="keyword">int</span>)</span> *<span class="title">Master</span></span> &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	m.mTasks = <span class="built_in">make</span>([]taskState, <span class="built_in">len</span>(files)) <span class="comment">// ç©ºé—´å¼€è¶³ï¼Œä¹‹å index è®¿é—®</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> files &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– Mission.Idï¼Œå’Œ task æ•°ç»„ä¸‹æ ‡å¯¹åº”ä¸Š</span></span><br><span class="line">		m.mMisson = <span class="built_in">append</span>(m.mMisson, Misson&#123;i, files[i:i+<span class="number">1</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">	m.rTasks = <span class="built_in">make</span>([]taskState, nReduce)   <span class="comment">// ç©ºé—´å¼€è¶³ï¼Œä¹‹å index è®¿é—®</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; nReduce; i++ &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– Mission.Idï¼Œå’Œ task æ•°ç»„ä¸‹æ ‡å¯¹åº”ä¸Š</span></span><br><span class="line">		m.rMisson = <span class="built_in">append</span>(m.rMisson, Misson&#123;i, <span class="literal">nil</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å› ä¸º<code>Mission.Id</code>å’Œ<code>taskState</code>æ•°ç»„æ˜¯å®Œå…¨å¯¹åº”çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯ worker è¶…æ—¶åå°†ä»»åŠ¡åˆ†é…ç»™åˆ«çš„ worker æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœåŒæ—¶æ¥åˆ°æ¥è‡ªä¸åŒ worker å¯¹åŒä¸€ä¸ªä»»åŠ¡çš„åé¦ˆï¼Œåªä¼šè¢«ç¡®è®¤ä¸€æ¬¡</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.824/labs/lab-mr.html">Ugh, the CSS in the Labs pages is so horrible for accessibility.</a> I cannot read the code snippets either. I love the course, but whoever made the webpages did not care a bit about accessibility or design of an interface.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone git://g.csail.mit.edu/6.824-golabs-2020 6.824 </span><br><span class="line">cd 6.824 </span><br></pre></td></tr></table></figure>
<p>Iâ€™ve cloned this repo. Apparently this one lecture is enough to get started. The course does recommend golang, but I am going to try some rudimentary stuff with Python, and I will get around to golang later, once I learn it.</p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2021-05-22</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Yann</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/Distributed-Systems/'>
                            Distributed Systems
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/Courses/'>
                            Courses
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2021/cmbf0eyfa000opwce1aam44qb/'>Convex Optimization-1</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2021/20210515/">flaskå®ç°å›¾åƒå¤„ç†API</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2025 China 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>
<script src="/js/emojiHandler.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    wrapEmojis('.paper');
  });
</script>