<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="CSRNetï¼šDilated Convolutional Neural Networks for Understanding the Highly Congested Scenes" />
    <meta name="hexo-theme-A4" content="v1.9.8" />
    <link rel="alternate icon" type="image/webp" href="/img/20250602032635.jpg">
    <title>Yann | æˆ‘æ„¿åšä½ å…‰åä¸­æ·¡æ·¡çš„ä¸€ç¬”</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="/css/custom.css">

    

<meta name="generator" content="Hexo 5.4.2"></head>
    
    

    
    



    

    
    




    
    <style>
        :root {
            --waline-theme-color: #323e74; 
            --waline-color: #323e74; 
            --waline-border-color: #323e74; 
            --waline-white: #323e74; 
            --waline-bgcolor-light: #f2fafc;  
        }
        body {
            color: #323e74;
            background: #eaeae8;
        }
        .post-md code {
            background: #e7f7f3;
            color: #7f688d; 
        }
        .post-md pre, .post-md .highlight {
            background: #e7f7f3;
            color: #7f688d; 
        }
        pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
            color: #323e74;
        }
        pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
            color: #323e74;
        }
        .year-font-color {
            color: #323e74 !important;
        }
        .wl-card span.wl-nick {
            color: #323e74; 
        }
        .wl-card .wl-badge {
            border: 1px solid #323e74;
            color: #323e74; 
        }
        .wl-btn {
            border: 1px solid #323e74; 
            color:  #323e74;  
        }
        .wl-btn.primary {
            color: #f2fafc; 
        }
        .wl-header label {
            color: #323e74;
        }
        a {
            color: #7f688d;
        }

        .post-md a {
            color: #7f688d;
        }

        .nav li a {
            color: #7f688d;
        }

        .archive-main a:link {
            color: #7f688d;
        }
        .archive-main a:visited {
            color: #767c7c; 
        }

        .archive li span {
            color: #323e74;
        }

        .post-main-title {
            color: #323e74;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #323e74;
        }

        [data-waline] p {
            color: #323e74;
        }
        [data-waline] a {
            color: #323e74;
        } 
        .wl-sort li.active {
            color: #323e74;
        }

        .wl-card .wl-meta>span {
            background: #f2fafc;
        }

        .paper {
            background: #eaeae8;
        }

        .index-main {
            background: #f2fafc;
        }

        .paper-main {
            background: #f2fafc;
        }

        .wl-panel {
            background: #f2fafc;
        }

        .archive li:nth-child(odd) {
            background: #f2fafc;
            ;
        }

        .archive li:nth-child(even) {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(odd) td {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(even) td {
            background: #f2fafc;
        }

    
        .progress-wrap::after {
            color: #323e74; /* ç®­å¤´çš„é¢œè‰² */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

        .return-to-last-progress-wrap::after {
            color: #323e74; /* ç®­å¤´çš„é¢œè‰² */
        }
        .return-to-last-progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .return-to-last-progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #323e74; /* è®¾ç½®æ»šåŠ¨æ¡æ‹–åŠ¨å—çš„é¢œè‰² */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: #7f688d;
            border-left-color: #7f688d;
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #323e74;
        }
    </style>

    
    <style>
        body {
            background-image: url(/img/3.jpg);
            background-attachment: fixed;  /* èƒŒæ™¯å›ºå®šï¼Œä¸éšé¡µé¢æ»šåŠ¨ */
            background-repeat: no-repeat;  /* é˜²æ­¢èƒŒæ™¯å›¾ç‰‡é‡å¤ */
            background-size: cover;       /* èƒŒæ™¯è‡ªé€‚åº”å¤§å°ï¼Œè¦†ç›–æ•´ä¸ªèƒŒæ™¯ */
            background-position: center;   /* èƒŒæ™¯å±…ä¸­æ˜¾ç¤º */
        }
        .paper {
            background-image: url(/img/3.jpg);
            background-attachment: fixed;  /* èƒŒæ™¯å›ºå®šï¼Œä¸éšé¡µé¢æ»šåŠ¨ */
            background-repeat: no-repeat;  /* é˜²æ­¢èƒŒæ™¯å›¾ç‰‡é‡å¤ */
            background-size: cover;       /* èƒŒæ™¯è‡ªé€‚åº”å¤§å°ï¼Œè¦†ç›–æ•´ä¸ªèƒŒæ™¯ */
            background-position: center;   /* èƒŒæ™¯å±…ä¸­æ˜¾ç¤º */
        }  
    </style>


    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #eaeae8  ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            
                <div class="left-toc-container">
                    <nav id="toc" class="bs-docs-sidebar"></nav>
                </div>
            
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 0; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/img/20250602032635.jpg" 
        />
        <div class="header-content">
            <a class="logo" href="/">Yann</a> 
            <span class="description">äººå·¥æ™ºèƒ½ã€è®¡ç®—æœºã€æœºå™¨å­¦ä¹ ã€linuxã€ç¨‹åºå‘˜</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    CSRNetï¼šDilated Convolutional Neural Networks for Understanding the Highly Congested Scenes
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2021-03-28</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š3.5k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š15åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1%E3%80%81MCNN%E7%9A%84%E5%A4%9A%E5%88%97%E8%AE%BE%E8%AE%A1%E6%B2%A1%E6%9C%89%E6%98%BE%E8%91%97%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="post-toc-text">1ã€MCNNçš„å¤šåˆ—è®¾è®¡æ²¡æœ‰æ˜¾è‘—ä½œç”¨ï¼š</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2%E3%80%81%E8%86%A8%E8%83%80%E5%8D%B7%E7%A7%AF%E4%BC%98%E4%BA%8E%E5%8F%8D%E5%8D%B7%E7%A7%AF"><span class="post-toc-text">2ã€è†¨èƒ€å·ç§¯ä¼˜äºåå·ç§¯</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%B4%A1%E7%8C%AE%EF%BC%9A"><span class="post-toc-text">è´¡çŒ®ï¼š</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%BB%E8%A6%81%E5%AE%9E%E7%8E%B0%EF%BC%9A"><span class="post-toc-text">ä¸»è¦å®ç°ï¼š</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="post-toc-text">ç½‘ç»œç»“æ„ï¼š</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%EF%BC%9A"><span class="post-toc-text">æ•°æ®å¢å¼ºï¼š</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="post-toc-text">æŸå¤±å‡½æ•°ï¼š</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9Ahttps-github-com-leeyeehoo-CSRNet-pytorch"><span class="post-toc-text">ä»£ç ï¼šhttps:&#x2F;&#x2F;github.com&#x2F;leeyeehoo&#x2F;CSRNet-pytorch</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#step1-install"><span class="post-toc-text">step1. install</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#step2-make-dataset-py"><span class="post-toc-text">step2.  make_dataset.py</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#step3-Training"><span class="post-toc-text">step3.  Training</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#step4-Testing"><span class="post-toc-text">step4. Testing</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Reading-paper-https-arxiv-org-pdf-1802-10062-pdf"><span class="post-toc-text">Reading paper   https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;1802.10062.pdf</span></a>
            
        
        <div class=".article-gallery"><blockquote>
<p>ä¸»è¦è§‚ç‚¹ï¼šCSRnetç½‘ç»œæ¨¡å‹ä¸»è¦åˆ†ä¸ºå‰ç«¯å’Œåç«¯ç½‘ç»œï¼Œé‡‡ç”¨å‰”é™¤äº†å…¨è¿æ¥å±‚çš„VGG-16ä½œä¸ºCSRnetçš„å‰ç«¯ç½‘ç»œï¼Œè¾“å‡ºå›¾åƒçš„å¤§å°ä¸ºåŸå§‹è¾“å…¥å›¾åƒçš„1/8ã€‚å·ç§¯å±‚çš„æ•°é‡å¢åŠ ä¼šå¯¼è‡´è¾“å‡ºçš„å›¾åƒå˜å°ï¼Œä»è€Œå¢åŠ ç”Ÿæˆå¯†åº¦å›¾çš„éš¾åº¦ã€‚æ‰€ä»¥æœ¬æ–‡é‡‡ç”¨ç©ºæ´å·ç§¯ç¥ç»ç½‘ç»œä½œä¸ºåç«¯ç½‘ç»œï¼Œåœ¨ä¿æŒåˆ†è¾¨ç‡çš„åŒæ—¶æ‰©å¤§æ„ŸçŸ¥åŸŸï¼Œ ç”Ÿæˆé«˜è´¨é‡çš„äººç¾¤åˆ†å¸ƒå¯†åº¦å›¾ã€‚</p>
</blockquote>
<span id="more"></span>  
<h5 id="1ã€MCNNçš„å¤šåˆ—è®¾è®¡æ²¡æœ‰æ˜¾è‘—ä½œç”¨ï¼š"><a href="#1ã€MCNNçš„å¤šåˆ—è®¾è®¡æ²¡æœ‰æ˜¾è‘—ä½œç”¨ï¼š" class="headerlink" title="1ã€MCNNçš„å¤šåˆ—è®¾è®¡æ²¡æœ‰æ˜¾è‘—ä½œç”¨ï¼š"></a>1ã€MCNNçš„å¤šåˆ—è®¾è®¡æ²¡æœ‰æ˜¾è‘—ä½œç”¨ï¼š</h5><p>â€‹    ä»¥å‰çš„æ‹¥æŒ¤åœºæ™¯åˆ†æå·¥ä½œä¸»è¦åŸºäº<code>multi-scale architectures</code>ã€‚å®ƒä»¬åœ¨è¯¥é¢†åŸŸå–å¾—äº†å¾ˆé«˜çš„æ€§èƒ½ï¼Œä½†æ˜¯å½“ç½‘ç»œå˜å¾—æ›´æ·±æ—¶ï¼Œå®ƒä»¬ä½¿ç”¨çš„è®¾è®¡ä¹Ÿå¸¦æ¥äº†ä¸¤ä¸ªæ˜¾ç€çš„ç¼ºç‚¹ï¼šå¤§é‡çš„è®­ç»ƒæ—¶é—´å’Œæ— æ•ˆçš„åˆ†æ”¯ç»“æ„ï¼ˆä¾‹å¦‚ï¼ŒMCNN ï¼‰ã€‚æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå®éªŒæ¥è¯æ˜MCNNä¸è¡¨1ä¸­æ›´æ·±å…¥çš„å¸¸è§„ç½‘ç»œç›¸æ¯”è¡¨ç°ä¸ä½³ã€‚</p>
<pre><code>å¦‚æˆ‘ä»¬å…ˆå‰æ‰€çŸ¥ï¼ŒMCNNçš„æ¯åˆ—ä¸“ç”¨äºæŸä¸€çº§åˆ«çš„æ‹¥å¡åœºæ™¯ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨MCNNçš„æœ‰æ•ˆæ€§å¯èƒ½å¹¶ä¸çªå‡ºã€‚æˆ‘ä»¬åœ¨å›¾2ä¸­å±•ç¤ºäº†MCNNä¸­ä¸‰ä¸ªç‹¬ç«‹åˆ—ï¼ˆä»£è¡¨å¤§ï¼Œä¸­ï¼Œå°çš„æ„Ÿå—é‡ï¼‰æ‰€å­¦ä¹ çš„ç‰¹å¾ï¼Œå¹¶ç”¨ShanghaiTech Part A [18]æ•°æ®é›†è¿›è¡Œè¯„ä¼°ã€‚è¯¥å›¾ä¸­çš„ä¸‰æ¡æ›²çº¿ä¸å…·æœ‰ä¸åŒæ‹¥å¡å¯†åº¦çš„50ä¸ªæµ‹è¯•æ¡ˆä¾‹å…±äº«éå¸¸ç›¸ä¼¼çš„æ¨¡å¼ï¼ˆä¼°è®¡çš„é”™è¯¯ç‡ï¼‰ï¼Œè¿™æ„å‘³ç€è¿™ç§åˆ†æ”¯ç»“æ„ä¸­çš„æ¯ä¸ªåˆ—å­¦ä¹ å‡ ä¹ç›¸åŒçš„ç‰¹å¾ã€‚å®ƒè¿èƒŒäº†MCNNè®¾è®¡çš„åˆè¡·ï¼Œç”¨äºå­¦ä¹ æ¯åˆ—çš„ä¸åŒåŠŸèƒ½ã€‚
</code></pre><h5 id="2ã€è†¨èƒ€å·ç§¯ä¼˜äºåå·ç§¯"><a href="#2ã€è†¨èƒ€å·ç§¯ä¼˜äºåå·ç§¯" class="headerlink" title="2ã€è†¨èƒ€å·ç§¯ä¼˜äºåå·ç§¯"></a>2ã€è†¨èƒ€å·ç§¯ä¼˜äºåå·ç§¯</h5><p>â€‹    å·²ç»åœ¨åˆ†å‰²ä»»åŠ¡ä¸­è¯æ˜äº†è†¨èƒ€å·ç§¯å±‚ï¼Œå…¶ç²¾åº¦å¾—åˆ°æ˜¾ç€æé«˜ï¼Œå¹¶ä¸”å®ƒæ˜¯æ± åŒ–å±‚çš„è‰¯å¥½æ›¿ä»£æ–¹æ¡ˆã€‚ å°½ç®¡æ± åŒ–å±‚ï¼ˆä¾‹å¦‚ï¼Œæœ€å¤§å’Œå¹³å‡æ± åŒ–ï¼‰è¢«å¹¿æ³›ç”¨äºç»´æŒä¸å˜æ€§å’Œæ§åˆ¶è¿‡åº¦æ‹Ÿåˆï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¾ç€åœ°é™ä½äº†ç©ºé—´åˆ†è¾¨ç‡ï¼Œè¿™æ„å‘³ç€ä¸¢å¤±äº†ç‰¹å¾æ˜ å°„çš„ç©ºé—´ä¿¡æ¯ã€‚ åå·ç§¯å±‚å¯ä»¥å‡è½»ä¿¡æ¯çš„ä¸¢å¤±ï¼Œä½†é¢å¤–çš„å¤æ‚æ€§å’Œæ‰§è¡Œå»¶è¿Ÿå¯èƒ½å¹¶ä¸é€‚åˆæ‰€æœ‰æƒ…å†µã€‚ è†¨èƒ€å·ç§¯æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå®ƒä½¿ç”¨ç¨€ç–å†…æ ¸ï¼ˆå¦‚å›¾3æ‰€ç¤ºï¼‰æ¥äº¤æ›¿æ±‡é›†å’Œå·ç§¯å±‚ã€‚ è¯¥å­—ç¬¦åœ¨ä¸å¢åŠ å‚æ•°æ•°é‡æˆ–è®¡ç®—é‡çš„æƒ…å†µä¸‹æ‰©å¤§äº†æ„Ÿå—é‡ï¼ˆä¾‹å¦‚ï¼Œæ·»åŠ æ›´å¤šå·ç§¯å±‚å¯ä»¥äº§ç”Ÿæ›´å¤§çš„æ„Ÿå—é‡ä½†å¼•å…¥æ›´å¤šæ“ä½œï¼‰ã€‚<br>â€‹     ä¸ºäº†ä¿æŒç‰¹å¾å›¾çš„åˆ†è¾¨ç‡ï¼Œä¸ä½¿ç”¨<code>å·ç§¯+æ± åŒ–+åå·ç§¯</code>çš„æ–¹æ¡ˆç›¸æ¯”ï¼Œ<code>è†¨èƒ€å·ç§¯</code>æ˜¾ç¤ºå‡ºæ˜æ˜¾çš„ä¼˜ç‚¹ã€‚æˆ‘ä»¬åœ¨å›¾4ä¸­é€‰æ‹©ä¸€ä¸ªä¾‹å­ç”¨äºè¯´æ˜ã€‚è¾“å…¥æ˜¯äººç¾¤çš„å›¾åƒï¼Œå¹¶ä¸”å®ƒåˆ†åˆ«é€šè¿‡ä¸¤ç§æ–¹æ³•å¤„ç†ä»¥äº§ç”Ÿå…·æœ‰ç›¸åŒå¤§å°çš„è¾“å‡ºã€‚åœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œè¾“å…¥ç”±å…·æœ‰å› å­2çš„æœ€å¤§æ± åŒ–å±‚è¿›è¡Œä¸‹é‡‡æ ·ï¼Œç„¶åå°†å…¶ä¼ é€’åˆ°å…·æœ‰3X3 Sobelå†…æ ¸çš„å·ç§¯å±‚ã€‚ç”±äºç”Ÿæˆçš„ç‰¹å¾æ˜ å°„ä»…æ˜¯åŸå§‹è¾“å…¥çš„1/2ï¼Œå› æ­¤éœ€è¦é€šè¿‡è§£å·ç§¯å±‚ï¼ˆåŒçº¿æ€§æ’å€¼ï¼‰<code>bilinear interpolation</code>å¯¹å…¶è¿›è¡Œä¸Šé‡‡æ ·ã€‚åœ¨å¦ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°è¯•æ‰©å¼ å·ç§¯å¹¶ä½¿ç›¸åŒçš„3X3 Sobelå†…æ ¸é€‚åº”å…·æœ‰å› å­= 2æ­¥å¹…çš„æ‰©å¼ å†…æ ¸ã€‚è¾“å‡ºä¸è¾“å…¥å…±äº«ç›¸åŒçš„ç»´åº¦ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæ‰©å¼ å·ç§¯çš„è¾“å‡ºåŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚</p>
<h3 id="è´¡çŒ®ï¼š"><a href="#è´¡çŒ®ï¼š" class="headerlink" title="è´¡çŒ®ï¼š"></a>è´¡çŒ®ï¼š</h3><p>â€‹    åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªæ›´æ·±å…¥çš„ç½‘ç»œï¼Œç§°ä¸º<code>CSR-Net</code>ï¼Œç”¨äºè®¡ç®—äººç¾¤å’Œç”Ÿæˆé«˜è´¨é‡çš„å¯†åº¦å›¾ã€‚æˆ‘ä»¬çš„æ¨¡å‹ä½¿ç”¨<code>çº¯å·ç§¯å±‚</code>ä½œä¸ºä¸»å¹²ï¼Œä»¥çµæ´»çš„åˆ†è¾¨ç‡æ”¯æŒè¾“å…¥å›¾åƒã€‚ä¸ºäº†é™åˆ¶ç½‘ç»œçš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰å±‚ä¸­ä½¿ç”¨<code>å°å°ºå¯¸</code>çš„å·ç§¯æ»¤æ³¢å™¨ï¼ˆå¦‚3x3ï¼‰ã€‚æˆ‘ä»¬å°†VGG-16 [21]çš„å‰10å±‚ä½œä¸ºå‰ç«¯å’Œ<code>è†¨èƒ€å·ç§¯å±‚</code>ä½œä¸ºåç«¯éƒ¨ç½²ï¼Œä»¥æ‰©å¤§æ„Ÿå—åŸŸå¹¶æå–æ›´æ·±çš„ç‰¹å¾è€Œä¸ä¼šä¸¢å¤±åˆ†è¾¨ç‡ï¼ˆå› ä¸ºä¸ä½¿ç”¨æ± åŒ–å±‚ï¼‰ã€‚</p>
<h3 id="ä¸»è¦å®ç°ï¼š"><a href="#ä¸»è¦å®ç°ï¼š" class="headerlink" title="ä¸»è¦å®ç°ï¼š"></a>ä¸»è¦å®ç°ï¼š</h3><h5 id="ç½‘ç»œç»“æ„ï¼š"><a href="#ç½‘ç»œç»“æ„ï¼š" class="headerlink" title="ç½‘ç»œç»“æ„ï¼š"></a>ç½‘ç»œç»“æ„ï¼š</h5><p>â€‹    æ­¤å‰ç«¯ç½‘ç»œçš„è¾“å‡ºå¤§å°æ˜¯åŸå§‹è¾“å…¥å¤§å°çš„<code>1/8</code>ã€‚å¦‚æœæˆ‘ä»¬ç»§ç»­å †å æ›´å¤šå·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼ˆVGG-16ä¸­çš„åŸºæœ¬ç»„ä»¶ï¼‰ï¼Œè¾“å‡ºå¤§å°å°†è¿›ä¸€æ­¥ç¼©å°ï¼Œå¹¶ä¸”å¾ˆéš¾ç”Ÿæˆé«˜è´¨é‡çš„å¯†åº¦æ˜ å°„ã€‚ æˆ‘ä»¬å°è¯•å°†è†¨èƒ€å·ç§¯å±‚ä½œä¸ºåç«¯æ¥æå–æ›´æ·±å±‚çš„æ˜¾ç€æ€§ä¿¡æ¯ä»¥åŠç»´æŒè¾“å‡ºåˆ†è¾¨ç‡ã€‚<br>â€‹     æˆ‘ä»¬åœ¨è¡¨3ä¸­æå‡ºäº†å››ç§CSRNetç½‘ç»œé…ç½®ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„å‰ç«¯ç»“æ„ä½†åç«¯çš„æ‰©å±•é€Ÿç‡ä¸åŒã€‚ å…³äºå‰ç«¯ï¼Œæˆ‘ä»¬é‡‡ç”¨VGG-16ç½‘ç»œï¼ˆå…¨è¿æ¥å±‚é™¤å¤–ï¼‰å¹¶ä»…ä½¿ç”¨3X3å†…æ ¸ã€‚ æ ¹æ®VGGçš„è®ºæ–‡ï¼Œå½“ä½¿ç”¨ç›¸åŒå¤§å°çš„æ„Ÿå—é‡æ—¶ï¼Œä½¿ç”¨å…·æœ‰å°å†…æ ¸çš„æ›´å¤šå·ç§¯å±‚æ¯”ä½¿ç”¨å…·æœ‰æ›´å¤§å†…æ ¸çš„æ›´å°‘å±‚æ›´æœ‰æ•ˆã€‚<br>â€‹     é€šè¿‡ç§»é™¤å®Œå…¨è¿æ¥çš„å±‚ï¼Œæˆ‘ä»¬å°è¯•ç¡®å®šéœ€è¦ä»VGG-16ä½¿ç”¨çš„å±‚æ•°ã€‚ æœ€å…³é”®çš„éƒ¨åˆ†æ˜¯åœ¨å‡†ç¡®æ€§å’Œèµ„æºå¼€é”€ï¼ˆåŒ…æ‹¬è®­ç»ƒæ—¶é—´ï¼Œå†…å­˜æ¶ˆè€—å’Œå‚æ•°æ•°é‡ï¼‰ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ å®éªŒè¡¨æ˜ï¼Œåœ¨ä¿æŒå‰åå±‚VGG-16 [21]åªæœ‰3ä¸ªæ± åŒ–å±‚è€Œä¸æ˜¯äº”å±‚æ—¶ï¼Œå¯ä»¥å®ç°æœ€ä½³æƒè¡¡ï¼Œä»¥æŠ‘åˆ¶ç”±æ± åŒ–æ“ä½œå¼•èµ·çš„å¯¹è¾“å‡ºç²¾åº¦çš„ä¸åˆ©å½±å“ã€‚ ç”±äºCSRNetçš„è¾“å‡ºï¼ˆå¯†åº¦å›¾ï¼‰è¾ƒå°ï¼ˆè¾“å…¥å°ºå¯¸çš„1/8ï¼‰ï¼Œæˆ‘ä»¬é€‰æ‹©å› å­ä¸º8çš„åŒçº¿æ€§æ’å€¼è¿›è¡Œç¼©æ”¾ï¼Œå¹¶ç¡®ä¿<code>è¾“å‡ºä¸è¾“å…¥å›¾åƒå…·æœ‰ç›¸åŒçš„åˆ†è¾¨ç‡</code>ã€‚ ä½¿ç”¨ç›¸åŒçš„å¤§å°ï¼ŒCSRNetç”Ÿæˆçš„ç»“æœä¸ä½¿ç”¨<code>PSNR</code>ï¼ˆå³°å€¼ä¿¡å™ªæ¯”ï¼‰å’Œ<code>SSIM</code>ï¼ˆå›¾åƒä¸­çš„ç»“æ„ç›¸ä¼¼æ€§ï¼‰çš„åŸºç¡€äº‹å®ç»“æœç›¸å½“ã€‚</p>
<h5 id="æ•°æ®å¢å¼ºï¼š"><a href="#æ•°æ®å¢å¼ºï¼š" class="headerlink" title="æ•°æ®å¢å¼ºï¼š"></a>æ•°æ®å¢å¼ºï¼š</h5><p>â€‹    æˆ‘ä»¬ä»ä¸åŒä½ç½®çš„æ¯ä¸ªå›¾åƒè£å‰ª9ä¸ªpatchesï¼ŒåŸå§‹å›¾åƒçš„å¤§å°ä¸º1/4ã€‚ å‰å››ä¸ªpatchesåŒ…å«å››åˆ†ä¹‹ä¸‰çš„å›¾åƒè€Œæ²¡æœ‰é‡å ï¼Œè€Œå…¶ä»–äº”ä¸ªpatchesåˆ™ä»è¾“å…¥å›¾åƒä¸­éšæœºè£å‰ªã€‚ ä¹‹åï¼Œæˆ‘ä»¬é•œåƒpatchesï¼Œä»¥ä¾¿æˆ‘ä»¬å°†è®­ç»ƒé›†åŠ å€ã€‚</p>
<h5 id="æŸå¤±å‡½æ•°ï¼š"><a href="#æŸå¤±å‡½æ•°ï¼š" class="headerlink" title="æŸå¤±å‡½æ•°ï¼š"></a>æŸå¤±å‡½æ•°ï¼š</h5><p>â€‹    ä½¿ç”¨ç®€å•çš„æ–¹æ³•å°†CSRNetä½œä¸ºç«¯åˆ°ç«¯ç»“æ„è¿›è¡ŒåŸ¹è®­ã€‚ å‰10ä¸ªå·ç§¯å±‚ç”±è®­ç»ƒæœ‰ç´ çš„VGG-16è¿›è¡Œå¾®è°ƒ[21]ã€‚ å¯¹äºå…¶ä»–å±‚ï¼Œåˆå§‹å€¼æ¥è‡ªå…·æœ‰0.01æ ‡å‡†åå·®çš„é«˜æ–¯åˆå§‹åŒ–ã€‚ éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰åœ¨è®­ç»ƒæœŸé—´ä»¥1e-6çš„å›ºå®šå­¦ä¹ ç‡åº”ç”¨ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬é€‰æ‹©æ¬§æ°è·ç¦»æ¥æµ‹é‡åœ°é¢å®å†µä¸æˆ‘ä»¬ç”Ÿæˆçš„ä¼°è®¡å¯†åº¦å›¾ä¹‹é—´çš„å·®å¼‚ï¼Œè¿™ä¸å…¶ä»–å·¥ä½œç±»ä¼¼[19,18,4]ã€‚ </p>
<pre><code>æˆ‘ä»¬è¿˜ä½¿ç”¨å’Œæ¥è¯„ä¼°ShanghaiTech Part Aæ•°æ®é›†ä¸Šè¾“å‡ºå¯†åº¦å›¾çš„è´¨é‡ã€‚ ä¸ºäº†è®¡ç®—å’Œï¼Œæˆ‘ä»¬éµå¾ª[5]ç»™å‡ºçš„é¢„å¤„ç†ï¼Œå…¶ä¸­åŒ…æ‹¬å¯†åº¦å›¾è°ƒæ•´å¤§å°ï¼ˆä¸åŸå§‹è¾“å…¥ç›¸åŒçš„å¤§å°ï¼‰ï¼Œå¯¹åœ°é¢å®å†µå’Œé¢„æµ‹å¯†åº¦å›¾è¿›è¡Œæ’å€¼å’Œå½’ä¸€åŒ–ã€‚     é™¤äº†äººç¾¤è®¡æ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨TRANCOSæ•°æ®é›†[44]ä¸Šè®¾ç½®äº†ä¸€ä¸ªå®éªŒï¼Œç”¨äºè½¦è¾†è®¡æ•°ï¼Œä»¥è¯æ˜æˆ‘ä»¬çš„æ–¹æ³•çš„ç¨³å¥æ€§å’Œä¸€èˆ¬åŒ–ã€‚ TRANCOSæ˜¯ä¸€ä¸ªå…¬å…±äº¤é€šæ•°æ®é›†ï¼ŒåŒ…å«ç”±ç›‘æ§æ‘„åƒæœºæ•è·çš„1244ä¸ªä¸åŒæ‹¥æŒ¤äº¤é€šåœºæ™¯çš„å›¾åƒï¼Œå…¶ä¸­åŒ…å«46796ä¸ªå¸¦æ³¨é‡Šçš„è½¦è¾†ã€‚ æ­¤å¤–ï¼Œæä¾›æ„Ÿå…´è¶£åŒºåŸŸï¼ˆROIï¼‰ç”¨äºè¯„ä¼°ã€‚ å›¾åƒçš„è§†è§’ä¸å›ºå®šï¼Œå›¾åƒæ˜¯ä»éå¸¸ä¸åŒçš„åœºæ™¯ä¸­æ”¶é›†çš„ã€‚ ç½‘æ ¼å¹³å‡å€¼å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆGAMEï¼‰[44]ç”¨äºæ­¤æµ‹è¯•ä¸­çš„ä¼°å€¼ã€‚ GAMEå®šä¹‰å¦‚ä¸‹ï¼š
</code></pre><h5 id="ä»£ç ï¼šhttps-github-com-leeyeehoo-CSRNet-pytorch"><a href="#ä»£ç ï¼šhttps-github-com-leeyeehoo-CSRNet-pytorch" class="headerlink" title="ä»£ç ï¼šhttps://github.com/leeyeehoo/CSRNet-pytorch"></a>ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/leeyeehoo/CSRNet-pytorch">https://github.com/leeyeehoo/CSRNet-pytorch</a></h5><p>æˆ‘åœ¨æ ¹æ®ä½œè€…çš„githubï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/leeyeehoo/CSRNet-pytorchï¼‰">https://github.com/leeyeehoo/CSRNet-pytorchï¼‰</a>, æ„å»ºç¯å¢ƒæ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚æˆ‘è°ƒè¯•è¿‡ï¼Œç™¾åº¦èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰è§£å†³ã€‚å†™è¿™ä¸€ç« çš„ç›®çš„æ˜¯å¸®åŠ©å¤§å®¶å­¦å¾—æ›´å¥½ï¼Œå°‘èµ°å¼¯è·¯ã€‚</p>
<hr>
<h2 id="step1-install"><a href="#step1-install" class="headerlink" title="step1. install"></a>step1. install</h2><p>For the specific installation process, you can refer to the authorâ€™s github. Here I simply show the command line of my operation.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">conda create -n CSRNet python=3.6</span><br><span class="line">source activate CSRNet</span><br><span class="line">unzip CSRNet-pytorch-master.zip</span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple torch torchvision</span><br><span class="line">pip install decorator cloudpickle&gt;=0.2.1 dask[array]&gt;=1.0.0 matplotlib&gt;=2.0.0 networkx&gt;=1.8 scipy&gt;=0.17.0 bleach python-dateutil&gt;=2.1 decorator</span><br><span class="line">unzip ShanghaiTech_Crowd_Counting_Dataset.zip</span><br><span class="line">jupyter nbconvert --to script make_dataset.ipynb  #Convert .ipynb file to .py file</span><br></pre></td></tr></table></figure>
<h2 id="step2-make-dataset-py"><a href="#step2-make-dataset-py" class="headerlink" title="step2.  make_dataset.py"></a>step2.  make_dataset.py</h2><p>I just run the command to convert the <strong>make_dataset.ipynb</strong> file to a <strong>make_dataset.py</strong> file.Now you need to modify the contents of the <strong>make_dataset.py</strong> file.</p>
<p>Find the location where <strong>root</strong> is, add <strong>def main()</strong> in the above line</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/enwoR46SIMsZv8l.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/enwoR46SIMsZv8l.png" alt=""></a></p>
<p>Add these two lines at the end of the <strong>make_dataset.py</strong>, adjust the format of the code</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/pKdG1rO62jefQv8.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/pKdG1rO62jefQv8.png" alt=""></a></p>
<p>There is an error in the authorâ€™s source code, you need to change the code</p>
<p>Replace <strong>pts = np.array(zip(np.nonzero(gt)[1], np.nonzero(gt)[0]))</strong> with <strong>pts = np.array(list(zip(np.nonzero(gt)[1], np.nonzero(gt)[0])))</strong> </p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/mgDRkCdfPTN1WOJ.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/mgDRkCdfPTN1WOJ.png" alt=""></a></p>
<p>Then run the <strong>make_dataset.py</strong> file</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/Pg6v4LujYbHOsxf.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/Pg6v4LujYbHOsxf.png" alt=""></a></p>
<hr>
<p><strong>The above is just a general summary, then we will run and visualize the line-by-line code.</strong></p>
<p>I will use this image as an example.</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/pdmkGTUvf6DZFwE.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/pdmkGTUvf6DZFwE.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># coding: utf-8</span><br><span class="line">import h5py</span><br><span class="line">import scipy.io as io</span><br><span class="line">import PIL.Image as Image</span><br><span class="line">import numpy as np</span><br><span class="line">import os</span><br><span class="line">import glob</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line">from scipy.ndimage.filters import gaussian_filter </span><br><span class="line">import scipy</span><br><span class="line">import json</span><br><span class="line">from matplotlib import cm as CM</span><br><span class="line">from image import *</span><br><span class="line">from model import CSRNet</span><br><span class="line">import torch</span><br><span class="line">img_path=&#x27;D:\\paper\\CSRNet\\CSRNet\\dataset\\Shanghai\\part_A_final\\train_data\\images\\IMG_21.jpg&#x27;</span><br><span class="line">mat=&#x27;D:\\paper\\CSRNet\\CSRNet\\dataset\\Shanghai\\part_A_final\\train_data\\ground_truth\\GT_IMG_21.mat&#x27;</span><br><span class="line">mat = io.loadmat(mat)</span><br><span class="line">img= plt.imread(img_path)</span><br><span class="line">k = np.zeros((img.shape[0],img.shape[1]))</span><br></pre></td></tr></table></figure>
<p>The following is the information of <strong>k</strong></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/tohJys8YT1OXNbd.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/tohJys8YT1OXNbd.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gt = mat[&quot;image_info&quot;][0,0][0,0][0]</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/CZNjq5xyzYuJ3Ic.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/CZNjq5xyzYuJ3Ic.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for i in range(0,len(gt)):</span><br><span class="line">    if int(gt[i][1])&lt;img.shape[0] and int(gt[i][0])&lt;img.shape[1]:</span><br><span class="line">        k[int(gt[i][1]),int(gt[i][0])]=1</span><br><span class="line">gt = k</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/KeWcb2EO5Dmjuka.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/KeWcb2EO5Dmjuka.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">density = np.zeros(gt.shape, dtype=np.float32)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/nhXEzgB2YT9iWFQ.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/nhXEzgB2YT9iWFQ.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gt_count = np.count_nonzero(gt)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/LdpFMxQURclJiau.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/LdpFMxQURclJiau.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pts = np.array(list(zip(np.nonzero(gt)[1], np.nonzero(gt)[0])))</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/utpH7GJKLF2gN6B.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/utpH7GJKLF2gN6B.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">leafsize = 2048</span><br><span class="line"># build kdtree</span><br><span class="line">tree = scipy.spatial.KDTree(pts.copy(), leafsize=leafsize)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/uYoVTODtg7EZq4N.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/uYoVTODtg7EZq4N.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distances, locations = tree.query(pts, k=4)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/uYoVTODtg7EZq4N.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/uYoVTODtg7EZq4N.png" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/lhQVo4bW1sqXp5L.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/lhQVo4bW1sqXp5L.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">print(&#x27;generate density...&#x27;)</span><br><span class="line">for i, pt in enumerate(pts):</span><br><span class="line">    pt2d = np.zeros(gt.shape, dtype=np.float32)</span><br><span class="line">    pt2d[pt[1],pt[0]] = 1.</span><br><span class="line">    if gt_count &gt; 1:</span><br><span class="line">        sigma = (distances[i][1]+distances[i][2]+distances[i][3])*0.1</span><br><span class="line">    else:</span><br><span class="line">        sigma = np.average(np.array(gt.shape))/2./2. #case: 1 point</span><br><span class="line">    density += scipy.ndimage.filters.gaussian_filter(pt2d, sigma, mode=&#x27;constant&#x27;)</span><br><span class="line">print(&#x27;done.&#x27;)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/9cj482YACKQGe7I.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/9cj482YACKQGe7I.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k = density</span><br><span class="line">with h5py.File(img_path.replace(&#x27;.jpg&#x27;,&#x27;.h5&#x27;).replace(&#x27;images&#x27;,&#x27;ground_truth&#x27;), &#x27;w&#x27;) as hf:</span><br><span class="line">        hf[&#x27;density&#x27;] = k</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/g6rPTmICwBUWJqR.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/g6rPTmICwBUWJqR.png" alt=""></a></p>
<p>So far, we have generated true values for the image.  At this point I will sort the above code as follows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># coding: utf-8</span><br><span class="line">import h5py</span><br><span class="line">import scipy.io as io</span><br><span class="line">import PIL.Image as Image</span><br><span class="line">import numpy as np</span><br><span class="line">import os</span><br><span class="line">import glob</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line">from scipy.ndimage.filters import gaussian_filter </span><br><span class="line">import scipy</span><br><span class="line">import json</span><br><span class="line">from matplotlib import cm as CM</span><br><span class="line">from image import *</span><br><span class="line">from model import CSRNet</span><br><span class="line">import torch</span><br><span class="line">def gaussian_filter_density(gt):</span><br><span class="line">    print(gt.shape)</span><br><span class="line">    density = np.zeros(gt.shape, dtype=np.float32)</span><br><span class="line">    gt_count = np.count_nonzero(gt)</span><br><span class="line">    if gt_count == 0:</span><br><span class="line">        return density</span><br><span class="line"></span><br><span class="line">    # pts = np.array(zip(np.nonzero(gt)[1], np.nonzero(gt)[0]))</span><br><span class="line">    pts = np.array(list(zip(np.nonzero(gt)[1], np.nonzero(gt)[0])))</span><br><span class="line">    leafsize = 2048</span><br><span class="line">    # build kdtree</span><br><span class="line">    tree = scipy.spatial.KDTree(pts.copy(), leafsize=leafsize)</span><br><span class="line">    # query kdtree</span><br><span class="line">    distances, locations = tree.query(pts, k=4)</span><br><span class="line"></span><br><span class="line">    print(&#x27;generate density...&#x27;)</span><br><span class="line">    for i, pt in enumerate(pts):</span><br><span class="line">        pt2d = np.zeros(gt.shape, dtype=np.float32)</span><br><span class="line">        pt2d[pt[1],pt[0]] = 1.</span><br><span class="line">        if gt_count &gt; 1:</span><br><span class="line">            sigma = (distances[i][1]+distances[i][2]+distances[i][3])*0.1</span><br><span class="line">        else:</span><br><span class="line">            sigma = np.average(np.array(gt.shape))/2./2. #case: 1 point</span><br><span class="line">        density += scipy.ndimage.filters.gaussian_filter(pt2d, sigma, mode=&#x27;constant&#x27;)</span><br><span class="line">    print(&#x27;done.&#x27;)</span><br><span class="line">    return density</span><br><span class="line">img_path=&#x27;D:\\paper\\CSRNet\\CSRNet\\dataset\\Shanghai\\part_A_final\\train_data\\images\\IMG_21.jpg&#x27;</span><br><span class="line">mat=&#x27;D:\\paper\\CSRNet\\CSRNet\\dataset\\Shanghai\\part_A_final\\train_data\\ground_truth\\GT_IMG_21.mat&#x27;</span><br><span class="line">img_paths = []</span><br><span class="line">img_paths.append(img_path)</span><br><span class="line">    for img_path in img_paths:</span><br><span class="line">        print(img_path)</span><br><span class="line">        mat = io.loadmat(mat)</span><br><span class="line">        img= plt.imread(img_path)        </span><br><span class="line">        k = np.zeros((img.shape[0],img.shape[1]))</span><br><span class="line">        gt = mat[&quot;image_info&quot;][0,0][0,0][0]</span><br><span class="line">        for i in range(0,len(gt)):</span><br><span class="line">            if int(gt[i][1])&lt;img.shape[0] and int(gt[i][0])&lt;img.shape[1]:</span><br><span class="line">                k[int(gt[i][1]),int(gt[i][0])]=1</span><br><span class="line">        k = gaussian_filter_density(k)        </span><br><span class="line">        with h5py.File(img_path.replace(&#x27;.jpg&#x27;,&#x27;.h5&#x27;).replace(&#x27;images&#x27;,&#x27;ground_truth&#x27;), &#x27;w&#x27;) as hf:</span><br><span class="line">                hf[&#x27;density&#x27;] = k</span><br></pre></td></tr></table></figure>
<hr>
<p>Andâ€¦.then, letâ€™s plot the true values of the image:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gt_file = h5py.File(img_paths[0].replace(&#x27;.jpg&#x27;,&#x27;.h5&#x27;).replace(&#x27;images&#x27;,&#x27;ground_truth&#x27;),&#x27;r&#x27;)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/K8SWQbPzkq4ei6a.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/K8SWQbPzkq4ei6a.png" alt=""></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groundtruth = np.asarray(gt_file[&#x27;density&#x27;])</span><br></pre></td></tr></table></figure>
<p>plot the true values of the image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.imshow(groundtruth,cmap=CM.jet)</span><br></pre></td></tr></table></figure>
<p>Calculate how many people are in this picture</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.sum(groundtruth)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Based on the same operation above, I generated true values for all images in the dataset. The following operations are performed on the gpu server.</strong></p>
<p>That is, run the command line <strong>python make_dataset.py</strong> on the server to get the true value of all the pictures.</p>
<h2 id="step3-Training"><a href="#step3-Training" class="headerlink" title="step3.  Training"></a>step3.  Training</h2><p><strong>Note</strong>: if you use the python3.x</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. In model.py, change the xrange in line 18 to range</span><br><span class="line">2. In model.py, change line 19 to: list(self.frontend.state_dict().items())[i][1].data[:] = list(mod.state_dict().items())[i][1].data[:]</span><br><span class="line">3. In image.py, change line 40 to: target = cv2.resize(target,(target.shape[1]//8,target.shape[0]//8),interpolation = cv2.INTER_CUBIC)*64</span><br></pre></td></tr></table></figure>
<ul>
<li>In  part_A_train.json:change the path of images</li>
<li>In  part_A_val.json: change the path of images</li>
</ul>
<p>run </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python train.py part_A_train.json part_A_val.json 0 0</span><br></pre></td></tr></table></figure>
<h2 id="step4-Testing"><a href="#step4-Testing" class="headerlink" title="step4. Testing"></a>step4. Testing</h2><p>These are our test images. numberï¼š182</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter nbconvert --to script val.ipynb</span><br></pre></td></tr></table></figure>
<p>Finally, the performance of this model on invisible data is tested. We will use the val.py file to verify the results. Remember to change the path to pre-train weights and images.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python val.py</span><br></pre></td></tr></table></figure>
<p>The average absolute error value that can be obtained by running this val.py file code</p>
<p>total ï¼š182</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/IboNJTvDgh8VOa9.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/IboNJTvDgh8VOa9.png" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/aMECFyiT6e4LqS7.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/aMECFyiT6e4LqS7.png" alt=""></a></p>
<p>The average absolute error value obtained is 65.96636956602663, which is very good.</p>
<hr>
<p>Now letâ€™s examine the predicted values on a single image:</p>
<p>run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test_single-image.py</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/WGPcwDxmfYCjBKQ.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/WGPcwDxmfYCjBKQ.png" alt=""></a><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/XmbDW9JzY65CBTV.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/XmbDW9JzY65CBTV.png" alt=""></a><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/kIjcnEDtfaFwLy7.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/kIjcnEDtfaFwLy7.png" alt=""></a></p>
<p>another one</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/1zHNh6qZI8iSmDT.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/1zHNh6qZI8iSmDT.png" alt=""></a><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/HkBcDnfxN7YuJSV.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/HkBcDnfxN7YuJSV.png" alt=""></a><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/UykOqSaWmBin1Dl.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/UykOqSaWmBin1Dl.png" alt=""></a></p>
<p>The effect is not too goodï¼Œmaybe the model is not trained enoughï¼Œi guessã€‚</p>
<hr>
<h2 id="Reading-paper-https-arxiv-org-pdf-1802-10062-pdf"><a href="#Reading-paper-https-arxiv-org-pdf-1802-10062-pdf" class="headerlink" title="Reading paper   https://arxiv.org/pdf/1802.10062.pdf"></a>Reading paper   <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1802.10062.pdf">https://arxiv.org/pdf/1802.10062.pdf</a></h2><p>å…ˆè¯´æ•°æ®é›†ç”¨çš„ShanghaiTech datasetï¼Œæ ¹æ®.jpgå’Œ.matå¤„ç†ä¹‹åç”Ÿæˆtrain_denæ–‡ä»¶å¤¹ä¸‹.csvæ–‡ä»¶å’Œå›¾ç‰‡ä¸€ä¸€å¯¹åº”<a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/tjIKHS7Q29FC5rV.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/tjIKHS7Q29FC5rV.png" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/tjIKHS7Q29FC5rV.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/tjIKHS7Q29FC5rV.png" alt=""></a></p>
<p>æ•°æ®é›†æ‰©å……å¤„ç†å†è¡¥å……ä¸€ä¸‹ï¼šä½¿ç”¨çš„æ˜¯é«˜æ–¯æ¨¡ç³Šä½œç”¨äºå›¾åƒä¸­çš„æ¯ä¸ªäººçš„å¤´éƒ¨ã€‚æ‰€æœ‰å›¾åƒéƒ½è¢«è£å‰ªæˆ9å—ï¼Œæ¯å—çš„å¤§å°æ˜¯å›¾åƒåŸå§‹å¤§å°çš„1/4ã€‚</p>
<hr>
<p>ç©ºæ´å·ç§¯ä¹Ÿæœ‰çš„åšå®¢ç¿»è¯‘æˆè†¨èƒ€å·ç§¯ã€æ‰©å¼ å·ç§¯å•¥çš„ï¼Œanywayï¼Œä½¿ç”¨æ‰©å¼ å·ç§¯æ˜¯åœ¨ä¸å¢åŠ å‚æ•°çš„æƒ…å†µä¸‹æ‰©å¤§å†…æ ¸ã€‚å› æ­¤ï¼Œå¦‚æœæ‰©å¼ ç‡ä¸º1å°±æ˜¯ä¸­é—´çš„å›¾åœ¨æ•´ä¸ªå›¾åƒä¸Šè¿›è¡Œå·ç§¯ã€‚å°†è†¨èƒ€ç‡å¢åŠ åˆ°2æœ€å³è¾¹å›¾å®ƒå¯ä»¥æ›¿ä»£poolingå±‚</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/HCJvzeDprl64k7N.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/HCJvzeDprl64k7N.png" alt=""></a></p>
<p>æ¥ä¸‹æ¥å†è¯´å®ƒçš„æ•°å­¦å…¬å¼ä¸Šæ€ä¹ˆè®¡ç®—çš„ï¼Œ</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/7kcQDAUlC5Z8a36.png" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/7kcQDAUlC5Z8a36.png" alt=""></a></p>
<p>ç”±ä¸Šå…¬å¼å¾—åˆ°è¿™ä¸ª([k + (k-1)<em>(r-1)] </em> [k + (k-1)*(r-1)])</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/4WRXklYKHSq2Cpe.png" title="1554628903758" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/4WRXklYKHSq2Cpe.png" alt="1554628903758"></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/P8GFQJHRwcnq3s1.png" title="1554628933425" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/P8GFQJHRwcnq3s1.png" alt="1554628933425"></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/uUj6KkXVzb1Moli.png" title="1554628946463" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/uUj6KkXVzb1Moli.png" alt="1554628946463"></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2020/06/14/xvocP3frquXzMKZ.png" title="1554628958176" class="gallery-item" style="box-shadow: none;"> <img src="https://i.loli.net/2020/06/14/xvocP3frquXzMKZ.png" alt="1554628958176"></a></p>
<p>è¿™ä¸ªè¿‡ç¨‹æ˜¯ï¼šé¦–å…ˆé¢„æµ‹å‡ºç»™å®šå›¾åƒçš„å¯†åº¦å›¾ã€‚å¦‚æœæ²¡æœ‰äººï¼Œåƒç´ å€¼pixel valueè®¾ä¸º0ã€‚å¦‚æœè¯¥åƒç´ å¯¹åº”äºäººï¼Œåˆ™å°†åˆ†é…æŸä¸ªé¢„å®šä¹‰å€¼ã€‚æ‰€ä»¥å›¾åƒä¸­çš„äººæ•°å°±æ˜¯æ€»å…±æœ‰çš„åƒç´ å€¼total pixel values </p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2019-12-18</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Yann</span>
            
            
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E7%AC%94%E8%AE%B0/'>
                            ç¬”è®°
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2019/2019122011/'>leetcode 483.æœ€å°å¥½è¿›åˆ¶</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2019/20191213002/">Fast Online Object Tracking and Segmentation:A Unifying Approach</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2025 China 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>
<script src="/js/emojiHandler.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    wrapEmojis('.paper');
  });
</script>